#!/bin/sh
# Pre-commit hook for NodeJS-Starter-V1
# Runs linting and dependency checks before committing

. "$(dirname "$0")/_/husky.sh"

# Run lint-staged (for linting and formatting)
pnpm lint-staged

# Quick dependency check if package files changed
if git diff --cached --name-only | grep -qE "package\.json|pnpm-lock\.yaml"; then
    echo "üì¶ Detected dependency changes, running verification..."

    # Source dependency checks
    if [ -f scripts/dependency-checks.sh ]; then
        . scripts/dependency-checks.sh

        # Run lockfile integrity check
        if ! check_lockfile_integrity >/dev/null 2>&1; then
            echo "‚ùå Lockfile integrity check failed"
            echo "   Run 'pnpm install' to fix and try again"
            exit 1
        fi

        echo "‚úÖ Dependency verification passed"
    fi
fi
