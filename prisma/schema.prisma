generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserWallet {
  id        String        @id @default(uuid())
  clerkId   String        @unique
  balance   Int           @default(0) // Stored in 'credits' (100 = $1.00)
  transactions Transaction[]
}

model Transaction {
  id          String     @id @default(uuid())
  walletId    String
  wallet      UserWallet @relation(fields: [walletId], references: [id])
  amount      Int        // Negative for usage, positive for top-up
  description String
  metadata    Json?
  createdAt   DateTime   @default(now())
}

model UserProfile {
  id                  String   @id @default(uuid())
  clerkId             String   @unique
  websiteUrl          String?
  brandConfig         Json?    // Stores extracted logo, fonts, colors (The Mirror)
  
  // Encrypted Keys (The Vault)
  googleApiKey        String?  // Google AI Studio / Gemini Key
  shopifyAccessToken  String?  // For Shopify sync
  redditApiKey        String?  // For Reddit scraping/posting
  socialApiKeys       Json?    // Encrypted map of other social keys (X, LinkedIn, etc.)
  
  integrations        Json?    // Connection status & metadata
  onboardingCompleted Boolean  @default(false)
  
  tasks               KanbanTask[]
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model KanbanTask {
  id          String   @id @default(uuid())
  clerkId     String
  profile     UserProfile @relation(fields: [clerkId], references: [clerkId])
  
  title       String
  description String?
  status      String   @default("OBLIGATION") // OBLIGATION, EXECUTION, VALIDATION, ARCHIVE
  priority    String   @default("MEDIUM")     // LOW, MEDIUM, HIGH, KINETIC
  
  dueDate     DateTime?
  payload     Json?    // Mission data (tool options, specs)
  resultUrl   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// v8.2 Mission Persistence
model Mission {
  id        String   @id @default(uuid())
  status    String   // PENDING, RUNNING, COMPLETED, FAILED
  plan      Json?
  result    Json?
  audit     Json?    // Independent Verification Report
  cost      Int
  userId    String   // Corresponds to clerkId/User ID
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
